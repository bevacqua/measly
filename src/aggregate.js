'use strict';

function expand (fn) {
  return function expansion (accumulator, child) {
    accumulator.push.apply(accumulator, fn(child));
    return accumulator;
  };
}

function requests (layer, clear) {
  var result = layer.requests.concat(layer.children.reduce(expand(requests), []));
  if (clear) {
    layer.requests = [];
  }
  return result;
}

function contexts (layer) {
  var self = [{
    context: layer.context,
    layer: layer
  }];
  return self.concat(layer.children.reduce(expand(contexts), []));
}

module.exports = {
  requests: requests,
  contexts: contexts
};
